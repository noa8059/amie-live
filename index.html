<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Amie ç³»åˆ—ä»£è³¼ç³»çµ±</title>
  <style>
    body { 
      font-family: sans-serif; 
      background: #f9f9f9; 
      padding: 2rem; 
      text-align: center; 
    }
    table { 
      margin: 0 auto 1rem; 
      border-collapse: collapse; 
    }
    th, td { 
      border: 1px solid #ccc; 
      padding: 0.5rem 1rem; 
    }
    /* æ”¾å¤§æ–‡å­—è¼¸å…¥æ¡† */
    input#name,
    input#contact {
      display: block;
      margin: 0.5rem auto;
      padding: 0.5rem;
      width: 200px;      /* æ¬„ä½å¯¬åº¦å¯è‡ªè¡Œèª¿æ•´ */
      font-size: 1rem;
    }
    /* ä¿æŒæ•¸å­—æ¬„ä½è¼ƒå° */
    input[type="number"] { 
      margin: 0 0.25rem; 
      width: 3rem; 
      padding: 0.25rem; 
    }
    .remain { 
      font-size: 0.9rem; 
      color: #555; 
      margin-left: 0.5rem; 
    }
    button { 
      padding: 0.5rem 1rem; 
      background: #333; 
      color: #fff; 
      border: none; 
      cursor: pointer; 
      font-size: 1rem;
    }
    #message { 
      margin-top: 1rem; 
      font-weight: bold; 
    }
    #orders div { 
      margin-bottom: 1rem; 
    }
  </style>
</head>
<body>
  <div id="root">è¼‰å…¥ä¸­...</div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const app = document.getElementById("root");
      const roles = ["27","R","18","69"];
      const boxLimits = { badge: 4, acrylic: 2 };
      const state = { name:"", contact:"", badge:{}, acrylic:{}, submitted:[] };

      function computeRemaining() {
        const rem = { badge:{}, acrylic:{} };
        roles.forEach(r => {
          rem.badge[r] = boxLimits.badge;
          rem.acrylic[r] = boxLimits.acrylic;
        });
        state.submitted.forEach(o => {
          roles.forEach(r => {
            if(o.badge[r]) rem.badge[r] -= o.badge[r];
            if(o.acrylic[r]) rem.acrylic[r] -= o.acrylic[r];
          });
        });
        return rem;
      }

      function render() {
        const rem = computeRemaining();
        // ç‹€æ³è¡¨æ ¼
        let table = `<h3>ç›®å‰ä¸‹å–®ç‹€æ³ï¼ˆå‰©é¤˜æ•¸é‡ï¼‰</h3>
          <table><thead>
          <tr><th>è§’è‰²</th><th>å¾½ç« å‰©é¤˜</th><th>å£“å…‹åŠ›å¡å‰©é¤˜</th></tr>
          </thead><tbody>`;
        roles.forEach(r => {
          table += `<tr><td>${r}</td>
            <td>${rem.badge[r]}</td>
            <td>${rem.acrylic[r]}</td></tr>`;
        });
        table += `</tbody></table>`;

        // è¡¨å–®
        let form = `
          <h2>Amie ç³»åˆ—ä»£è³¼</h2>
          <input placeholder="ç¨±å‘¼" id="name" />
          <input placeholder="å™—æµªæˆ–è‡‰æ›¸å¸³è™Ÿ" id="contact" />
          <h3>å¾½ç« ï¼ˆ140å…ƒï¼‰</h3>
          ${roles.map(r => `<label>${r}
            <input type="number" min="0" id="badge-${r}" value="0" />
            <span class="remain">å‰©é¤˜${rem.badge[r]}</span>
          </label>`).join("")}
          <h3>å£“å…‹åŠ›å¡ï¼ˆ145å…ƒï¼‰</h3>
          ${roles.map(r => `<label>${r}
            <input type="number" min="0" id="acrylic-${r}" value="0" />
            <span class="remain">å‰©é¤˜${rem.acrylic[r]}</span>
          </label>`).join("")}
          <br/><br/>
          <button id="submit">é€å‡ºè¨‚å–®</button>
          <div id="message"></div>
          <hr/>
          <h3>ğŸ“¦ ä¸‹å–®ç´€éŒ„</h3>
          <div id="orders"></div>
        `;

        app.innerHTML = table + form;

        document.getElementById("submit").onclick = () => {
          state.name = document.getElementById("name").value.trim();
          state.contact = document.getElementById("contact").value.trim();
          state.badge = {}; state.acrylic = {};
          roles.forEach(r => {
            const b = parseInt(document.getElementById("badge-"+r).value) || 0;
            const a = parseInt(document.getElementById("acrylic-"+r).value) || 0;
            if(b) state.badge[r] = b;
            if(a) state.acrylic[r] = a;
          });
          const sel = Object.keys(state.badge).concat(Object.keys(state.acrylic));
          document.getElementById("message").innerText =
            (sel.includes("18")||sel.includes("27"))
              ? "âš ï¸ æ‚¨é¸æ“‡äº†ç†±é–€è§’è‰²ï¼Œå¯èƒ½éœ€è¦ç¶è§’ï¼Œè‹¥éœ€ç¶è§’å°‡å¦è¡Œé€šçŸ¥ã€‚"
              : "âœ… è¨‚å–®å·²é€å‡ºï¼";
          state.submitted.push({
            name:state.name, contact:state.contact,
            badge:{...state.badge}, acrylic:{...state.acrylic}
          });
          render();       // æ›´æ–°è¡¨æ ¼èˆ‡å‰©é¤˜æ•¸
          renderOrders();
        };
      }

      function renderOrders() {
        const c = document.getElementById("orders");
        c.innerHTML = state.submitted.map(o=>{
          return `<div><strong>${o.name}</strong>ï¼ˆ${o.contact}ï¼‰<br/>
            å¾½ç« ï¼š${JSON.stringify(o.badge)}<br/>
            å£“å…‹åŠ›å¡ï¼š${JSON.stringify(o.acrylic)}</div>`;
        }).join("");
      }

      render();
    });
  </script>
</body>
</html>
